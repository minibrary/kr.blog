---
layout: post
title: '라즈베리파이로 시스템 모니터링 대시보드 만들기'
date: 2017-5-27 21:00:00 +0900
description: 그라파나 (grafana)를 이용한 라즈베리파이 시스템 모니터링 대시보드
tags:
- 'Raspberry Pi'
- '시스템 모니터링'
categories:
twitter_text: '라즈베리파이로 시스템 모니터링 대시보드 만들기'
published: false
---
라즈베리파이로 시스템 모니터링 대시보드를 만들어 보겠습니다.

이 포스트에서 사용할 도구 및 환경

* 라즈베리파이 1, 라즈베리파이3 + 라즈비안 8 Jessie
* grafana 웹 대시보드
* postgreSQL
* apache
* graphite
* collectd

grafana 와 graphite에 대한 이해는 아래 블로그를 참고하였습니다.

[그라파이트(Grahpite) + 그라파나(Grafana) 모니터링 시스템 구축 with Docker](http://blog.nacyot.com/articles/2014-07-17-graphite-with-dokcer/){:target="_blank"}


`collecd`로 시스템 데이터 수집 ▶ `graphite-carbon`으로 전송 ▶ `graphite-web`을 통해 `grafana`로 전송 ▶ `apache`로 웹 서버 구동

## 1. graphite, python-Tools, apache 설치

```
sudo apt update
```

```
sudo apt-get install build-essential graphite-web graphite-carbon python-dev apache2 libapache2-mod-wsgi libpq-dev python-psycopg2
```

## 2. graphite

### a) storage-schemas.conf 설정

`whisper`의 데이터 보존 기간을 설정합니다. `storage-schemas.conf`는 특정 패턴의 네임스페이스 데이터의 보존 기간을 정의합니다. 여기서는 [collectd]라는 설정을 만들어, `collectd`로 시작하는 데이터의 보존 기간을 다음과 같이 설정 하겠습니다.

* 5초 간격: 1주일
* 1분 간격: 7일
* 10분 간격: 1년


```
sudo nano /etc/carbon/storage-schemas.conf
```

```
[carbon]
pattern = ^carbon\.
retentions = 60:90d

[collectd]
pattern = ^collectd\.
retentions = 5s:1w,1m:7d,10m:1y

[default_1min_for_1day]
pattern = .*
retentions = 60s:1d
```

저장 후 종료합니다.

### b) storage-aggregation.conf 설정

여기서는 graphite 설치 시 예제로 설치 되는 설정 파일을 그대로 사용하겠습니다.

```
sudo cp /usr/share/doc/graphite-carbon/examples/storage-aggregation.conf.example /etc/carbon/storage-aggregation.conf
```

### c) carbon-cache를 유효화

```
sudo nano /etc/default/graphite-carbon
```

false 를 true 로 바꿔줍니다.

```
CARBON_CACHE_ENABLED=true
```

### d) 부팅 시 carbon-cache 시작 등록

```
sudo systemctl enable carbon-cache
```

## 3. postgreSQL

`graphite` 및 `grafana`의 웹에서 사용 할 `user` 등의 데이터를 저장하는 데이터베이스로 `postgreSQL`을 사용하겠습니다.

### a) postgresql 설치

```
sudo apt-get install postgresql
```

### b) postgres cli 들어가기

```
sudo su - postgres
```

### c) grafana 및 graphite에서 사용할 DB 사용자 만들기 

여기서는 `raspberrypi` 라는 사용자를 만들고, 비밀번호를 `SuperSecret`으로 하겠습니다.

```
createuser raspberrypi --pwprompt
```

### d) grafana 및 graphite에서 사용할 DB 만들기

`grafana` 와 `graphite` 라는 DB를 만들고, 방금 만든 사용자 `raspberrypi`를 각 DB의 관리자로 하겠습니다.

```
createdb -O raspberrypi graphite
```

```
createdb -O raspberrypi grafana
```

### e) 원래 계정으로 돌아옵니다.

```
exit
```
